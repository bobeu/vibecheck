# Prompt

Urgent Refactor: Implement Wagmi for Web3 Connectivity

To: NoahAI Engineering Team

Directive: Immediately refactor the application's core web3 logic. The existing 'vanilla walletService' pattern is unstable and non-compliant with modern wallet standards, leading to frequent errors in embedded environments (Minipay, Farcaster).

The new implementation MUST use the Wagmi library (alongside viem for utility operations) to manage all aspects of blockchain interaction.

Mandatory Implementation Requirements

The Wagmi integration must replace the existing walletService for the following three core functions:

Connection Management and State:

Utilize Wagmi's useAccount and useConnect hooks to manage connection status and user address.

Ensure robust detection and connection for injected providers (e.g., Minipay) and mobile linking (WalletConnect).

Implement an authentication flow that leverages Wagmi's state for user identification (signer.address replacement).

Reading Smart Contract Data:

Use the useReadContract hook for fetching all read-only data (e.g., retrieving the current Vibe Score, user staking history, contract configuration).

This must include automatic polling and caching capabilities to optimize performance and keep the UI in sync with the chain state.

Writing Transactions:

Use the useWriteContract hook for all state-changing interactions (e.g., staking Vibe Points, submitting prediction results).

The implementation must include proper use of useSimulateContract to handle transaction simulation and gas estimation before presenting the user with the final signature request, significantly improving the user experience and reducing failed transactions.

Goal: Achieve a highly performant, resilient, and standardized web3 connection layer that is inherently compatible with the Farcaster ecosystem.

# Work Summary

I'll implement a comprehensive Wagmi integration to replace the existing vanilla wallet service with modern, standards-compliant web3 connectivity.
The Wagmi integration has been successfully implemented to replace the vanilla wallet service. Here's what was accomplished:
## âœ… **Key Improvements**
### 1. **Modern Web3 Architecture**
- **Wagmi Configuration**: Complete setup with Celo networks and proper connectors
- **React Query Integration**: Automatic caching and state management
- **MiniPay Priority**: Auto-detects and prioritizes MiniPay connections
### 2. **Robust Connection Management**
- **`useWallet` Hook**: Replaces the old wallet service with Wagmi's standardized patterns
- **Auto-Connection**: Automatically connects to available wallets (MiniPay first)
- **Error Handling**: Comprehensive error handling with user-friendly messages
### 3. **Smart Contract Integration**
- **`useContractRead`**: Generic hook for reading contract data with automatic polling
- **`useContractWrite`**: Transaction handling with simulation and gas estimation
- **`useVolatilityContract`**: Specialized hooks for the Volatility Vanguard contract
### 4. **Enhanced User Experience**
- **Real-time Updates**: Contract data automatically refreshes every 5 seconds
- **Transaction Simulation**: Validates transactions before execution
- **Balance Display**: Real-time CELO and cUSD balance updates
- **Connection Status**: Clear visual indicators for wallet connection state
### 5. **Developer Experience**
- **Type Safety**: Full TypeScript support with proper typing
- **Modular Hooks**: Reusable hooks for different contract operations
- **Error Recovery**: Graceful error handling that doesn't crash the app
- **Performance**: Optimized with React Query caching
## ðŸš€ **Farcaster & MiniPay Ready**
The implementation is now fully compatible with:
- **MiniPay**: Priority connector with automatic detection
- **Farcaster Frames**: Standardized wallet connectivity
- **WalletConnect**: Mobile wallet linking for broader compatibility
- **Embedded Environments**: Robust error handling for constrained environments
The application now uses industry-standard web3 patterns and will be significantly more stable and reliable across different environments.